<!DOCTYPE html>
<html>
  <head>
    <title>Multiplayer Autofahren</title>
    <style>
      .car {
        position: absolute;
        width: 100px;
        height: 50px;
        background-color: lightgreen;
        border-radius: 10px;
        transition: left 0.2s linear, top 0.2s linear, transform 0.2s linear;
      }
    </style>
  </head>
  <body>
    <script>
      const socket = new WebSocket("ws://localhost:8080");

      const cars = {};

      socket.addEventListener("open", (event) => {
        console.log("Verbunden mit dem WebSocket-Server");
      });

      socket.addEventListener("message", (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "init") {
          // Initialisierung - Daten für alle Autos erhalten
          const { clientId, cars } = data;

          // Für jedes Auto ein DOM-Element erstellen und hinzufügen
          for (const carId in cars) {
            const car = createCarElement(carId);
            document.body.appendChild(car);
          }

          // Event Listener für Tastatureingaben hinzufügen
          window.addEventListener("keydown", handleKeyDown);
          window.addEventListener("keyup", handleKeyUp);
        } else if (data.type === "update") {
          // Aktualisierte Daten für ein Auto erhalten
          const { car } = data;

          // Das DOM-Element des Autos aktualisieren
          updateCarElement(car.id, car.x, car.y, car.rotation);
        } else if (data.type === "remove") {
          // Ein Auto wurde entfernt
          const { clientId } = data;

          // Das DOM-Element des Autos entfernen
          removeCarElement(clientId);
        }
      });

      function createCarElement(carId) {
        const car = document.createElement("div");
        car.id = carId;
        car.classList.add("car");
        return car;
      }

      function updateCarElement(carId, x, y, rotation) {
        const car = document.getElementById(carId);
        car.style.left = x + "px";
        car.style.top = y + "px";
        car.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
      }

      function removeCarElement(carId) {
        const car = document.getElementById(carId);
        if (car) {
          car.parentNode.removeChild(car);
        }
      }

      function handleKeyDown(event) {
        const key = event.keyCode;

        // Tastatur-Eingaben verarbeiten und Nachrichten an den Server senden
        if (key === 37 || key === 39 || key === 38 || key === 40) {
          event.preventDefault();
          const speed = key === 38 ? 1 : key === 40 ? -1 : 0;
          const rotation = key === 37 ? -5 : key === 39 ? 5 : 0;
          socket.send(
            JSON.stringify({ type: "update", x: 0, y: 0, rotation, speed })
          );
        }
      }

      function handleKeyUp(event) {
        const key = event.keyCode;

        // Tastatur-Eingaben verarbeiten und Nachrichten an den Server senden
        if (key === 37 || key === 39 || key === 38 || key === 40) {
          event.preventDefault();
          socket.send(
            JSON.stringify({
              type: "update",
              x: 0,
              y: 0,
              rotation: 0,
              speed: 0,
            })
          );
        }
      }
    </script>
  </body>
</html>
